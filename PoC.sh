#!/bin/bash 
#AUTHOR : MALAK ALFOSAIL #GENERAL COMMENTS: 
# MEMORY DUMP SHOULD BE GENERATED BEFORE RUNNING THIS SCRIPT 
# VOLATILITY AND BULK EXTRACTOR SHOULD BE IN MACHINE RUNNINF THIS SCRIPT 
All_Process='' 
P=',' 
count='1' 
#Procces IDs. 
volatility --profile=Win10x64_10586 -f $1 pslist | egrep 'firefox.exe|tor.exe' > Process.txt 
#Time launched 
Time=`cat Process.txt | grep "tor.exe" | awk '{ print $9,$10}'` 
#To read all the process numbers.. 
while read -r Process 
do 
	ProcessNum=`echo $Process | cut -d " " -f3` 
	if [ $count = "0" ] 
	then 
		All_Process+="${P}${ProcessNum}" 
	else 
		All_Process+="${ProcessNum}" 
		count='0' 
	fi 
done < Process.txt 
#Produce the cache records (URL) 
volatility --profile=Win10x64_10586 -f memory.dmp yarascan -Y '/(URL)/' -p "$All_Process" | grep ".onion" -A 15 -B 15 > CACHE_RECORD.txt 
#Produce the HTTP Requests (GET,POST) 
volatility --profile=Win10x64_10586 -f memory.dmp yarascan -Y '/(GET|POST)/' -p "$All_Process" | grep ".onion" -A 15 -B 15 > HTTP_Requests.txt 
#Use Bulk extractor to dump memory dump details 
bulk_extractor -o Bulk_Files $1 

# Extract the visited site in Tor Browser 
cat Bulk_Files/url.txt | grep .onion | awk '{print $2}' | sort | uniq -c > Sites.txt 

Visited_Site=`cat Sites.txt | sort -n | tail -2`

NumberOfProcess=`cat Process.txt | wc -l`
cat > Report.txt << EOF 

This File was generated By Tor Forensics Script 

This File shows the analysis results of "$1" 

It was launched at "$Time"

Number of Processes Related to Tor is "$NumberOfProcess" 

HTTP Requests can be found on HTTP_Requests.txt

Cache Records details can be found on CACHE_Records.txt 

The user visited the following site: 
"$Visited_Site" 

More details about the memory dump can be found on Bulk_Files Folder 
EOF


